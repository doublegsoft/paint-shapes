<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<canvas id="canvas" style="width: 500px; height: 300px;"></canvas>
</body>
</html>
<script src="./paint-shapes.js" type="application/javascript"></script>
<script>

var scale = window.devicePixelRatio || 1;
var canvas = document.getElementById('canvas');
canvas.width = `${500 * scale}`;
canvas.height = `${300 * scale}`;
var ctx = canvas.getContext("2d");
ctx.scale(scale, scale);

var selectedShape = null;
var selectedOffset = null;
var isDragging = false;
var playground = new FlatPlayground(ctx, 500 * scale, 300 * scale);

var circle = new Circle(new Point(100, 100), 25);
circle.backgroundColor = new Color(255, 128, 56);
playground.addShape(circle);

var square = new Square(new Point(100, 200), 50);
square.borderRadius = 10;
square.backgroundColor = new Color(255, 128, 56);
playground.addShape(square);

var diamond = new Diamond(new Point(300, 200), 100, 50);
diamond.backgroundColor = new Color(255, 128, 56);
playground.addShape(diamond);

var rectangle = new Rectangle(new Point(250, 50), 100, 50);
rectangle.borderRadius = 10;
rectangle.backgroundColor = new Color(255, 128, 56);
playground.addShape(rectangle);

playground.connect(diamond, rectangle);
playground.connect(circle, square);
playground.connect(square, rectangle);

// playground.drawQuadraticCurveWithArrow(new Point(50, 50), new Point(200, 200), 50);

canvas.addEventListener('mousedown', ev => {
  const p = new Point(ev.layerX, ev.layerY);
  selectedShape = playground.select(ev.layerX, ev.layerY);
  if (selectedShape == null) {
    return;
  }
  selectedOffset = selectedShape.offset(p);
  isDragging = true;
});

canvas.addEventListener('mouseup', ev => {
  isDragging = false;
});

canvas.addEventListener('mousemove', ev => {
  if (!isDragging || selectedShape == null) {
    return;
  }
  const p = new Point(ev.layerX, ev.layerY);
  playground.shiftShape(selectedShape, p, selectedOffset);
})
</script>
